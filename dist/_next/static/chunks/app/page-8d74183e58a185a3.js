(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2969:(e,t,r)=>{"use strict";r.d(t,{default:()=>F});var l=r(5155),n=r(2115),a=r(9675),i=r(3394);let s=[[/^((My|Your|Full( legal)?) )?Name$/i,"users1_name"],[/^(Typed or )?Printed Name\s?\d*$/i,"users1_name"],[/^(DOB|Date of Birth|Birthday)$/i,"users1_birthdate"],[/^(Street )?Address$/i,"users1_address_line_one"],[/^City State Zip$/i,"users1_address_line_two"],[/^City$/i,"users1_address_city"],[/^State$/i,"users1_address_state"],[/^Zip( Code)?$/i,"users1_address_zip"],[/^(Phone|Telephone)$/i,"users1_phone_number"],[/^Email( Address)?$/i,"users1_email"],[/^plaintiff\(?s?\)?$/i,"plaintiff1_name"],[/^defendant\(?s?\)?$/i,"defendant1_name"],[/^petitioner\(?s?\)?$/i,"petitioners1_name"],[/^respondent\(?s?\)?$/i,"respondents1_name"],[/^(Court\s)?Case\s?(No|Number)?\s?A?$/i,"docket_number"],[/^file\s?(No|Number)?\s?A?$/i,"docket_number"],[/^(Signature|Sign( here)?)\s?\d*$/i,"users1_signature"],[/^Date\s?\d*$/i,"signature_date"]],o=["a","an","the","and","or","but","in","on","at","to","for","of"],d=null,c=async()=>(d||(d=Promise.all([r.e(213),r.e(376)]).then(r.bind(r,9139)).then(e=>e)),d),u=["Helvetica","Helvetica-Bold","Times-Roman","Times-Bold","Courier","Courier-Bold"],h=Object.entries({text:"Single-line Text",multiline:"Multi-line Text",checkbox:"Checkbox",signature:"Signature",radio:"Radio Group",dropdown:"Dropdown",listbox:"List Box",button:"Button"}).map(e=>{let[t,r]=e;return{value:t,label:r}}),x={text:"Single-line Text",multiline:"Multi-line Text",checkbox:"Checkbox",signature:"Signature",radio:"Radio Group",dropdown:"Dropdown",listbox:"List Box"},f={text:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:(0,l.jsx)("path",{d:"M4 7V4h16v3M9 20h6M12 4v16"})})},multiline:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:(0,l.jsx)("path",{d:"M3 6h18M3 10h18M3 14h18M3 18h10"})})},checkbox:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[(0,l.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,l.jsx)("path",{d:"m9 12 2 2 4-4"})]})},signature:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[(0,l.jsx)("path",{d:"m14.5 3.5 6 6-11 11H3v-6.5l11-11Z"}),(0,l.jsx)("path",{d:"M17 6.5 20.5 3l-3.5-3.5L13.5 3 17 6.5Z"})]})},radio:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,l.jsx)("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor"})]})},dropdown:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[(0,l.jsx)("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),(0,l.jsx)("path",{d:"m7 10 5 5 5-5"})]})},listbox:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[(0,l.jsx)("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),(0,l.jsx)("path",{d:"M7 8h10M7 12h10M7 16h4"})]})},button:e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[(0,l.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"4",ry:"4"}),(0,l.jsx)("circle",{cx:"12",cy:"12",r:"2"})]})}},p=e=>"text"===e||"multiline"===e,m=(e,t,r)=>Math.min(Math.max(e,t),r),g=(e,t)=>{let r=m(e.width/t.width,.01,1),l=m(e.height/t.height,.01,1);return{x:m(e.x/t.width,0,1-r),y:m(1-(e.y+e.height)/t.height,0,1-l),width:r,height:l}},b=async(e,t)=>{try{let r=await i.PDFDocument.load(e),l=r.getForm(),n=r.getPages(),s=new Set,o=[];return l.getFields().forEach(e=>{let r,l=null;if(e instanceof i.PDFTextField?l=e.isMultiline()?"multiline":"text":e instanceof i.PDFCheckBox?l="checkbox":e instanceof i.PDFSignature?l="signature":e instanceof i.PDFRadioGroup?(l="radio",r=e.getOptions()):e instanceof i.PDFDropdown?(l="dropdown",r=e.getOptions()):e instanceof i.PDFOptionList?(l="listbox",r=e.getOptions()):e instanceof i.PDFButton&&(l="button"),!l)return;let d=e.acroField.getWidgets();if(d.length)if("radio"===l){var c;let i=d.map(e=>e.getRectangle()).filter(Boolean);if(0===i.length)return;let u=d[0].P(),h=0;if(u){let e=n.findIndex(e=>{var t;return(null!=(t=e.ref)?t:null)===u});e>=0&&(h=e)}let x=null!=(c=t[h])?c:n[h].getSize(),f=i.map(e=>g(e,x)),p=Math.min(...f.map(e=>e.x)),m=Math.min(...f.map(e=>e.y)),b=Math.max(...f.map(e=>e.x+e.width)),y=Math.max(...f.map(e=>e.y+e.height)),w=e.getName()||v(l,o),j=N(w,s);o.push({id:(0,a.A)(),name:j,type:l,pageIndex:h,rect:{x:p,y:m,width:b-p,height:y-m},options:r,widgetRects:f,autoSize:!0,font:"Helvetica",fontSize:12})}else d.forEach(i=>{var d;let c=i.getRectangle();if(!c)return;let u=i.P(),h=0;if(u){let e=n.findIndex(e=>{var t;return(null!=(t=e.ref)?t:null)===u});e>=0&&(h=e)}let x=null!=(d=t[h])?d:n[h].getSize(),f=g(c,{width:x.width,height:x.height}),p=e.getName()||v(l,o),m=N(p,s);o.push({id:(0,a.A)(),name:m,type:l,pageIndex:h,rect:f,options:r,autoSize:!0,font:"Helvetica",fontSize:12})})}),o}catch(e){return console.warn("Unable to parse existing form fields",e),[]}},y=e=>{let{pdf:t,pageIndex:r,renderScale:a,fields:i,selectedTool:s,onCreateField:o,onSelectField:d,onMoveField:c,onResizeField:u,selectedFieldId:h}=e,x=(0,n.useRef)(null),p=(0,n.useRef)(null),[g,b]=(0,n.useState)(null),y=(0,n.useRef)(null),w=(0,n.useRef)(null),v=(0,n.useRef)(null),[N,j]=(0,n.useState)(null),F=e=>{let{field:t}=e;return(0,l.jsx)(l.Fragment,{children:[{handle:"nw",cursor:"nw-resize",position:"top-0 left-0 -translate-x-1/2 -translate-y-1/2"},{handle:"ne",cursor:"ne-resize",position:"top-0 right-0 translate-x-1/2 -translate-y-1/2"},{handle:"sw",cursor:"sw-resize",position:"bottom-0 left-0 -translate-x-1/2 translate-y-1/2"},{handle:"se",cursor:"se-resize",position:"bottom-0 right-0 translate-x-1/2 translate-y-1/2"},{handle:"n",cursor:"n-resize",position:"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2"},{handle:"s",cursor:"s-resize",position:"bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2"},{handle:"e",cursor:"e-resize",position:"top-1/2 right-0 translate-x-1/2 -translate-y-1/2"},{handle:"w",cursor:"w-resize",position:"top-1/2 left-0 -translate-x-1/2 -translate-y-1/2"}].map(e=>{let{handle:n,cursor:a,position:i}=e;return(0,l.jsx)("div",{className:"absolute w-2 h-2 bg-blue-600 border border-white rounded-sm ".concat(i),style:{cursor:a},onPointerDown:e=>((e,l)=>{e.stopPropagation();let n=P(e);v.current={pageIndex:r,fieldId:t.id,pointerId:e.pointerId,handle:l,initialRect:{...t.rect},startPoint:n};let a=p.current;a&&a.setPointerCapture(e.pointerId)})(e,n)},n)})})};(0,n.useEffect)(()=>{let e=!1,l=null;return(async()=>{try{let n=await t.getPage(r+1);if(e)return;let i=n.getViewport({scale:a}),s=x.current;if(!s)return;let o=s.getContext("2d");if(!o)return;s.width=i.width,s.height=i.height,e||b({width:i.width,height:i.height}),l=n.render({canvasContext:o,canvas:s,viewport:i}),await l.promise}catch(e){if("RenderingCancelledException"===e.name)return;console.error("Failed to render PDF page",e)}})().catch(e=>{console.error("Failed to render PDF page",e)}),()=>{e=!0,l&&l.cancel()}},[t,r,a]);let P=(0,n.useCallback)(e=>{let t=p.current;if(!t)return{x:0,y:0};let r=t.getBoundingClientRect();return{x:(e.clientX-r.left)/r.width,y:(e.clientY-r.top)/r.height}},[]),k=(0,n.useCallback)(()=>{let e=y.current;if(!e)return;let{start:t,current:l}=e,n=Math.min(t.x,l.x),a=Math.min(t.y,l.y),i=Math.abs(l.x-t.x),s=Math.abs(l.y-t.y);y.current=null,j(null),i<.01||s<.01||o(r,{x:m(n,0,1),y:m(a,0,1),width:m(i,.01,1),height:m(s,.01,1)})},[o,r]),D=(0,n.useCallback)(()=>{let e=y.current;if(!e)return;let{start:t,current:r}=e;j({x:Math.min(t.x,r.x),y:Math.min(t.y,r.y),width:Math.abs(r.x-t.x),height:Math.abs(r.y-t.y)})},[]);(0,n.useEffect)(()=>{let e=e=>{let t=y.current,r=w.current,l=v.current;if(!t&&!r&&!l||!p.current)return;let n=P(e);if(t)t.current=n,D();else if(r){let e=i.find(e=>e.id===r.fieldId);if(!e)return;let t=m(n.x-r.offset.x,0,1-e.rect.width),l=m(n.y-r.offset.y,0,1-e.rect.height);c(e.id,{...e.rect,x:t,y:l})}else if(l){let{initialRect:e,startPoint:t,handle:r}=l,a=n.x-t.x,i=n.y-t.y,s={...e};r.includes("n")&&(s.y=e.y+i,s.height=e.height-i),r.includes("s")&&(s.height=e.height+i),r.includes("w")&&(s.x=e.x+a,s.width=e.width-a),r.includes("e")&&(s.width=e.width+a),s.width=Math.max(.01,s.width),s.height=Math.max(.01,s.height),s.x=m(s.x,0,1-s.width),s.y=m(s.y,0,1-s.height),u(l.fieldId,s)}},t=()=>{y.current&&k(),w.current=null,v.current=null,y.current=null,j(null)};return window.addEventListener("pointermove",e),window.addEventListener("pointerup",t),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t)}},[i,k,P,c,u,D]);let S=e=>g?{left:"".concat(100*e.x,"%"),top:"".concat(100*e.y,"%"),width:"".concat(100*e.width,"%"),height:"".concat(100*e.height,"%")}:{left:0,top:0,width:0,height:0};return(0,l.jsxs)("div",{ref:p,className:"relative border border-slate-300 bg-white shadow-sm",onPointerDown:e=>{if(p.current&&0===e.button&&s){let t=P(e);y.current={pageIndex:r,start:t,current:t},j({x:t.x,y:t.y,width:0,height:0}),p.current.setPointerCapture(e.pointerId),e.preventDefault();return}},onPointerMove:e=>{let t=y.current,r=w.current,l=v.current;if(p.current){if(t){t.current=P(e),D();return}if(r){let t=P(e),l=i.find(e=>e.id===r.fieldId);if(!l)return;let n=m(t.x-r.offset.x,0,1-l.rect.width),a=m(t.y-r.offset.y,0,1-l.rect.height);c(l.id,{...l.rect,x:n,y:a});return}if(l){let t=P(e),{initialRect:r,startPoint:n,handle:a}=l,i=t.x-n.x,s=t.y-n.y,o={...r};a.includes("n")&&(o.y=r.y+s,o.height=r.height-s),a.includes("s")&&(o.height=r.height+s),a.includes("w")&&(o.x=r.x+i,o.width=r.width-i),a.includes("e")&&(o.width=r.width+i),o.width=Math.max(.01,o.width),o.height=Math.max(.01,o.height),o.x=m(o.x,0,1-o.width),o.y=m(o.y,0,1-o.height),u(l.fieldId,o)}}},onPointerUp:e=>{let t=p.current;t&&t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),w.current&&(w.current=null),v.current&&(v.current=null),y.current&&k()},role:"presentation",children:[(0,l.jsx)("canvas",{ref:x,className:"block w-full h-auto"}),(0,l.jsxs)("div",{className:"absolute inset-0",children:[i.map(e=>(0,l.jsxs)("div",{className:"absolute rounded ".concat(h===e.id?"border-2 border-blue-600 bg-blue-500/20":"border border-sky-400 bg-sky-300/10 hover:border-sky-500"," cursor-move"),style:S(e.rect),onPointerDown:t=>((e,t)=>{if(e.stopPropagation(),s)return;d(t.id);let l=P(e);w.current={pageIndex:r,fieldId:t.id,pointerId:e.pointerId,offset:{x:l.x-t.rect.x,y:l.y-t.rect.y}};let n=p.current;n&&n.setPointerCapture(e.pointerId)})(t,e),children:[g&&(0,l.jsxs)("span",{className:"absolute left-1 top-1 bg-slate-800/80 text-white text-xs px-1 py-px rounded flex items-center gap-1 max-w-full overflow-hidden whitespace-nowrap",style:{fontSize:e.rect.width*g.width<60?"10px":"12px",display:e.rect.width*g.width<30||e.rect.height*g.height<20?"none":"flex"},children:["signature"===e.type&&e.rect.width*g.width>=50&&(0,l.jsx)(f.signature,{className:"w-3 h-3 flex-shrink-0"}),(0,l.jsx)("span",{className:"truncate",children:e.rect.width*g.width<80?e.name.slice(0,8)+(e.name.length>8?"...":""):e.name})]}),h===e.id&&(0,l.jsx)(F,{field:e})]},e.id)),N?(0,l.jsx)("div",{className:"absolute border-2 border-dashed border-amber-500 bg-amber-400/10",style:S(N)}):null]})]})},w=e=>{let{fields:t,selectedFieldId:r,onSelect:a,onChange:i,onDelete:s,recentlyDeleted:o,onUndoDelete:d}=e,c=(0,n.useRef)({});return(0,n.useEffect)(()=>{if(!r)return;let e=c.current[r];e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})},[r]),(0,l.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"Fields"}),o?(0,l.jsxs)("div",{className:"flex items-center justify-between rounded border border-amber-300 bg-amber-50 p-2 text-sm",children:[(0,l.jsxs)("span",{className:"text-amber-800",children:["Deleted ",(0,l.jsx)("strong",{children:o.name})]}),(0,l.jsx)("button",{type:"button",onClick:d,className:"rounded bg-amber-100 px-2 py-1 font-semibold text-amber-800 hover:bg-amber-200",children:"Undo"})]}):null,0===t.length?(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"Use the tools to draw fields on the PDF. They will appear here for quick editing."}):(0,l.jsx)("div",{className:"flex flex-col gap-3 overflow-y-auto pr-2",children:t.map(e=>{var t,n;let o=p(e.type),d=r===e.id;return(0,l.jsxs)("div",{ref:t=>{c.current[e.id]=t},className:"rounded border ".concat(d?"border-blue-600 shadow-md":"border-slate-200"," bg-white text-sm transition-all"),children:[(0,l.jsxs)("div",{className:"flex cursor-pointer items-start justify-between gap-2 rounded-t p-3 ".concat(d?"bg-blue-100":"hover:bg-slate-50"),onClick:()=>a(d?null:e.id),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&a(d?null:e.id)},role:"button",tabIndex:0,children:[(0,l.jsx)("span",{className:"font-medium text-slate-800",children:e.name}),(0,l.jsx)("button",{type:"button",onClick:t=>{var r;t.stopPropagation(),r=e.id,window.confirm("Are you sure you want to delete this field?")&&s(r)},className:"rounded bg-rose-50 px-2 py-1 text-xs font-semibold text-rose-600 hover:bg-rose-100",children:"Delete"})]}),d?(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-3 border-t border-slate-200 p-3",children:[(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-xs uppercase text-slate-500",children:"Field Name"}),(0,l.jsx)("input",{type:"text",value:e.name,onChange:t=>i(e.id,{name:t.target.value}),className:"rounded border border-slate-300 px-2 py-1 text-sm focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"})]}),(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-xs uppercase text-slate-500",children:"Field Type"}),(0,l.jsx)("select",{value:e.type,onChange:t=>i(e.id,{type:t.target.value}),className:"rounded border border-slate-300 px-2 py-1 text-sm capitalize focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",children:h.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{className:"text-xs uppercase text-slate-500",children:["Page ",(0,l.jsx)("span",{className:"font-semibold normal-case text-slate-700",children:e.pageIndex+1})]}),o?(0,l.jsxs)("div",{className:"flex flex-col gap-2 border-t border-slate-200 pt-3",children:[(0,l.jsxs)("label",{className:"flex flex-col gap-1 text-xs",children:[(0,l.jsx)("span",{className:"uppercase text-slate-500",children:"Font"}),(0,l.jsx)("select",{value:e.font,onChange:t=>{var r;return r=t.target.value,void i(e.id,{font:r})},className:"rounded border border-slate-300 px-2 py-1 text-sm focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",children:u.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("label",{className:"flex items-center justify-between gap-2 text-xs",children:[(0,l.jsx)("span",{className:"uppercase text-slate-500",children:"Auto Size"}),(0,l.jsx)("input",{type:"checkbox",checked:e.autoSize,onChange:t=>i(e.id,{autoSize:t.target.checked}),className:"h-4 w-4"})]}),e.autoSize?null:(0,l.jsxs)("label",{className:"flex flex-col gap-1 text-xs",children:[(0,l.jsx)("span",{className:"uppercase text-slate-500",children:"Font Size"}),(0,l.jsx)("input",{type:"number",min:4,max:72,value:e.fontSize,onChange:t=>((e,t)=>{let r=Number(t);Number.isFinite(r)&&i(e.id,{fontSize:m(r,4,72)})})(e,t.target.value),className:"rounded border border-slate-300 px-2 py-1 text-sm focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"})]})]}):null,(e=>"radio"===e||"dropdown"===e||"listbox"===e)(e.type)?(0,l.jsx)("div",{className:"flex flex-col gap-2 border-t border-slate-200 pt-3",children:(0,l.jsxs)("label",{className:"flex flex-col gap-1 text-xs",children:[(0,l.jsx)("span",{className:"uppercase text-slate-500",children:"Options"}),(0,l.jsx)("textarea",{value:null!=(n=null==(t=e.options)?void 0:t.join(", "))?n:"",onChange:t=>i(e.id,{options:t.target.value.split(",").map(e=>e.trim())}),className:"rounded border border-slate-300 px-2 py-1 text-sm focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"})]})}):null]}):null]},e.id)})})]})};function v(e,t){let r="text"===e?"Text":"multiline"===e?"Multiline":"checkbox"===e?"Checkbox":"signature"===e?"Signature":"radio"===e?"Radio Group":"dropdown"===e?"Dropdown":"listbox"===e?"List Box":"Button",l=t.filter(t=>t.type===e).length+1;return"".concat(r," ").concat(l)}let N=(e,t)=>{let r=e.trim()||"Field",l=1;for(;t.has(r);)r="".concat(e.trim()||"Field"," ").concat(++l);return t.add(r),r},j=async(e,t)=>{let r="Helvetica"===t?i.StandardFonts.Helvetica:"Helvetica-Bold"===t?i.StandardFonts.HelveticaBold:"Times-Roman"===t?i.StandardFonts.TimesRoman:"Times-Bold"===t?i.StandardFonts.TimesRomanBold:"Courier"===t?i.StandardFonts.Courier:i.StandardFonts.CourierBold;return e.embedStandardFont(r)},F=()=>{let e=(0,n.useRef)(null),[t,r]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)([]),[g,F]=(0,n.useState)(null),[P,k]=(0,n.useState)([]),[D,S]=(0,n.useState)(null),[C,B]=(0,n.useState)(null),[z,_]=(0,n.useState)(null),[M,E]=(0,n.useState)("edited-form"),[R,I]=(0,n.useState)(!1),[T,A]=(0,n.useState)(!1),[$,O]=(0,n.useState)(null),L=(0,n.useRef)(null),U=(0,n.useRef)({}),W=(0,n.useCallback)(async()=>{if(e.current)return e.current;let t=await c();return e.current=t,t.GlobalWorkerOptions.workerSrc="/pdf-editor-ui/pdf.worker.min.mjs",t},[]);(0,n.useEffect)(()=>{W().catch(e=>{console.error("Failed to initialize pdf.js",e),O("Unable to initialize the PDF renderer. Please refresh and try again.")})},[W]);let H=(0,n.useCallback)(async e=>{O(null),I(!0);try{var t,l;let n=await e.arrayBuffer(),a=new Uint8Array(n),i=new Uint8Array(a),s=await W();d&&await d.destroy();let o=s.getDocument({data:a}),c=await o.promise,h=[];for(let e=1;e<=c.numPages;e+=1){let t=(await c.getPage(e)).getViewport({scale:1});h.push({width:t.width,height:t.height})}let x=await b(i,h);r(i),u(c),m(h),k(x),S(null!=(l=null==(t=x[0])?void 0:t.id)?l:null),E(e.name.replace(/\.pdf$/i,"")||"edited-form")}catch(e){console.error(e),O("Unable to open the selected PDF. Please try another file.")}finally{I(!1)}},[W,d]),G=(0,n.useCallback)(async e=>{e.preventDefault(),e.stopPropagation(),A(!1);let t=e.dataTransfer.files;if(t&&t.length>0){let e=t[0];e&&"application/pdf"===e.type&&await H(e)}},[H]),Z=(0,n.useCallback)(()=>{C&&B(null)},[C]),V=e=>{Z(),S(e)};(0,n.useEffect)(()=>{if(!D)return;let e=P.find(e=>e.id===D);if(!e)return;let t=U.current[e.pageIndex];t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})},[D,P]);let K=(0,n.useCallback)(async e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&(await H(r),L.current&&(L.current.value=""))},[H]),Y=(0,n.useCallback)((e,t)=>{if(!g)return;Z();let r={id:(0,a.A)(),name:v(g,P),type:g,pageIndex:e,rect:t,autoSize:!0,font:"Helvetica",fontSize:12};if(p(g))r.autoSize=!1,r.fontSize=10;else if("radio"===g){r.options=["Option 1","Option 2"];let e=t.height/2;r.widgetRects=[{...t,height:e},{...t,y:t.y+e,height:e}]}k(e=>[...e,r]),S(r.id),F(null)},[P,g,Z]),q=(0,n.useCallback)((e,t)=>{k(r=>r.map(r=>r.id===e?{...r,rect:t}:r))},[]),X=(0,n.useCallback)((e,t)=>{k(r=>r.map(r=>r.id===e?{...r,rect:t}:r))},[]),J=(0,n.useCallback)(async()=>{if(!t)return void O("Upload a PDF before exporting.");O(null);try{let n=await i.PDFDocument.load(t),a=new Map,s=n.getForm(),o=n.getPages(),d=new Set,c=n.context;s.acroForm.dict.set(i.PDFName.of("Fields"),c.obj([])),o.forEach(e=>{e.node.set(i.PDFName.of("Annots"),c.obj([]))});let u=(e,t,r)=>{var l;let a=s.acroForm,o=n.context.obj({FT:i.PDFName.of("Sig"),Kids:[]}),d=n.context.register(o),c=i.PDFAcroSignature.fromDict(o,d);c.setPartialName(e);let u=a.normalizedEntries(),h=null!=(l=null==u?void 0:u.Kids)?l:null==u?void 0:u.Fields;for(let[t]of(0,i.createPDFAcroFields)(h))if(t.getPartialName()===e)throw Error("A field named ".concat(e," already exists in the document."));a.addField(d);let x=i.PDFWidgetAnnotation.create(n.context,d);x.setRectangle(r),x.setFlagTo(i.AnnotationFlags.Print,!0),x.setP(t.ref),x.dict.delete(i.PDFName.of("BS")),x.dict.delete(i.PDFName.of("Border")),x.dict.delete(i.PDFName.of("BG")),x.dict.delete(i.PDFName.of("BC"));let f=n.context.register(x.dict);c.addWidget(f),t.node.addAnnot(f)};for(let t of P){var e,r,l;let c=o[t.pageIndex];if(!c)continue;let{width:h,height:x}=c.getSize(),f={x:t.rect.x*h,y:x-(t.rect.y+t.rect.height)*x,width:t.rect.width*h,height:t.rect.height*x},p=(null==(e=t.name)?void 0:e.trim())||v(t.type,P),m=N(p,d);if("text"===t.type||"multiline"===t.type){let e=s.createTextField(m);if(e.addToPage(c,f),"multiline"===t.type?e.enableMultiline():e.disableMultiline(),!a.has(t.font)){let e=await j(n,t.font);a.set(t.font,e)}let r=a.get(t.font);e.updateAppearances(r),t.autoSize||e.setFontSize(t.fontSize),e.acroField.getWidgets().forEach(e=>{e.dict.delete(i.PDFName.of("BS")),e.dict.delete(i.PDFName.of("Border")),e.dict.delete(i.PDFName.of("BG")),e.dict.delete(i.PDFName.of("BC"))})}else if("checkbox"===t.type){let e=s.createCheckBox(m);e.addToPage(c,f),e.acroField.getWidgets().forEach(e=>{e.dict.delete(i.PDFName.of("BS")),e.dict.delete(i.PDFName.of("Border")),e.dict.delete(i.PDFName.of("BG")),e.dict.delete(i.PDFName.of("BC"))})}else if("signature"===t.type)u(m,c,f);else if("dropdown"===t.type){let e=s.createDropdown(m);e.addOptions(null!=(r=t.options)?r:[]),e.addToPage(c,f),e.acroField.getWidgets().forEach(e=>{e.dict.delete(i.PDFName.of("BS")),e.dict.delete(i.PDFName.of("Border")),e.dict.delete(i.PDFName.of("BG")),e.dict.delete(i.PDFName.of("BC"))})}else if("listbox"===t.type){let e=s.createOptionList(m);e.addOptions(null!=(l=t.options)?l:[]),e.addToPage(c,f),e.acroField.getWidgets().forEach(e=>{e.dict.delete(i.PDFName.of("BS")),e.dict.delete(i.PDFName.of("Border")),e.dict.delete(i.PDFName.of("BG")),e.dict.delete(i.PDFName.of("BC"))})}else if("button"===t.type){let e=s.createButton(m);e.addToPage(c,f),e.acroField.getWidgets().forEach(e=>{e.dict.delete(i.PDFName.of("BS")),e.dict.delete(i.PDFName.of("Border")),e.dict.delete(i.PDFName.of("BG")),e.dict.delete(i.PDFName.of("BC"))})}else"radio"===t.type&&console.warn("Exporting radio groups is not yet implemented.")}let h=await n.save(),x=new ArrayBuffer(h.byteLength);new Uint8Array(x).set(h);let f=new Blob([x],{type:"application/pdf"}),p=URL.createObjectURL(f),m=document.createElement("a");m.href=p,m.download="".concat(M||"edited-form","-with-fields.pdf"),document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(p)}catch(e){console.error(e),O("Something went wrong while embedding the fields. Please verify your fields and try again.")}},[P,M,t]),Q=(0,n.useMemo)(()=>h.map((e,t)=>P.filter(e=>e.pageIndex===t)),[P,h]);return(0,l.jsxs)("div",{className:"flex h-full w-full flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded border border-slate-200 bg-white p-4 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("label",{className:"inline-flex items-center gap-2 rounded border border-dashed border-slate-300 px-3 py-2 text-sm font-medium text-slate-700 hover:border-slate-400",children:[(0,l.jsx)("input",{ref:L,type:"file",accept:"application/pdf",onChange:K,className:"hidden"}),"Upload PDF"]}),R?(0,l.jsx)("span",{className:"text-sm text-slate-500",children:"Loadingâ€¦"}):null,d?(0,l.jsxs)("span",{className:"text-sm text-slate-500",children:[d.numPages," page",1===d.numPages?"":"s"]}):null]}),(0,l.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:Object.keys(x).map(e=>{let t=f[e];return(0,l.jsxs)("button",{type:"button",onClick:()=>(e=>{F(t=>t===e?null:e)})(e),className:"flex items-center gap-2 rounded px-3 py-2 text-sm font-medium transition ".concat(g===e?"bg-sky-600 text-white shadow":"bg-slate-100 text-slate-800 hover:bg-slate-200"),children:[(0,l.jsx)(t,{className:"w-4 h-4"}),x[e]]},e)})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"text",value:M,onChange:e=>E(e.target.value),placeholder:"File name",className:"w-40 rounded border border-slate-300 px-2 py-1 text-sm focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"}),(0,l.jsx)("button",{type:"button",onClick:()=>{_(P),k((e=>{let t=e.map(e=>({...e,name:(e=>{let t=(e=>{for(let[t,r]of s)if(t.test(e.trim()))return r;return null})(e);if(t)return t;let r=(e=>{let t=e.replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/([A-Z])/g,"_$1").replace(/[\s\-]+/g,"_").replace(/__+/g,"_").replace(/^_|_$/g,"").toLowerCase();return/^[0-9]/.test(t)&&(t="_".concat(t)),t})(e);return(r=r.split("_").filter(e=>!o.includes(e)).join("_")).length>30&&(r=r.substring(0,30)),r})(e.name)})),r=new Map;for(let e of t)r.has(e.name)||r.set(e.name,[]),r.get(e.name).push(e);for(let e of r.values())e.length>1&&e.forEach((e,t)=>{e.name="".concat(e.name,"__").concat(t+1)});return t})(P))},className:"rounded bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-800 transition hover:bg-slate-300 disabled:cursor-not-allowed disabled:bg-slate-100",children:"Normalize Names"}),z?(0,l.jsx)("button",{type:"button",onClick:()=>{z&&(k(z),_(null))},className:"rounded bg-amber-100 px-4 py-2 text-sm font-semibold text-amber-800 transition hover:bg-amber-200",children:"Undo Normalize"}):null,(0,l.jsx)("button",{type:"button",onClick:J,disabled:!d||0===P.length,className:"rounded bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-emerald-500 disabled:cursor-not-allowed disabled:bg-emerald-200",children:"Export PDF"})]})]}),$?(0,l.jsx)("div",{className:"rounded border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-600",children:$}):null,(0,l.jsxs)("div",{className:"flex min-h-0 flex-1 gap-4",children:[(0,l.jsx)("div",{className:"flex-1 overflow-auto rounded border-2 bg-slate-50 p-4 ".concat(T?"border-dashed border-sky-500":"border-slate-200"),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),A(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),A(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:G,children:d?(0,l.jsx)("div",{className:"flex flex-col gap-6",children:h.map((e,t)=>{var r;return(0,l.jsx)("div",{ref:e=>{U.current[t]=e},children:(0,l.jsx)(y,{pdf:d,pageIndex:t,renderScale:1.2,fields:null!=(r=Q[t])?r:[],selectedTool:g,onCreateField:Y,onSelectField:V,onMoveField:q,onResizeField:X,selectedFieldId:D})},t)})}):(0,l.jsx)("div",{className:"flex h-full items-center justify-center text-center text-slate-500",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"Upload a PDF to begin adding form fields."}),(0,l.jsx)("p",{className:"mt-2 text-sm",children:"Or drag and drop a PDF here."})]})})}),(0,l.jsx)("div",{className:"w-80 flex-shrink-0 rounded border border-slate-200 bg-white p-4 shadow-sm",children:(0,l.jsx)(w,{fields:P,selectedFieldId:D,onSelect:V,onChange:(e,t)=>{Z();let r=P.find(t=>t.id===e);if(r){if("radio"===r.type&&"checkbox"===t.type){var l,n,i;let t=(null!=(n=r.widgetRects)?n:[]).map((e,t)=>({id:(0,a.A)(),name:"".concat(r.name," ").concat(t+1),type:"checkbox",pageIndex:r.pageIndex,rect:e,autoSize:!0,font:"Helvetica",fontSize:12}));k(r=>[...r.filter(t=>t.id!==e),...t]),S(null!=(i=null==(l=t[0])?void 0:l.id)?i:null);return}k(r=>r.map(r=>{if(r.id!==e)return r;if(t.type&&t.type!==r.type){if(p(t.type)&&p(r.type))return{...r,...t};if(p(t.type)){var l,n,a;return{...r,...t,type:t.type,autoSize:null==(l=r.autoSize)||l,font:null!=(n=r.font)?n:"Helvetica",fontSize:null!=(a=r.fontSize)?a:12}}return{...r,...t,type:t.type,autoSize:!0}}return{...r,...t}}))}},onDelete:e=>{let t=P.find(t=>t.id===e);t&&(B(t),k(t=>t.filter(t=>t.id!==e)),S(t=>t===e?null:t))},recentlyDeleted:C,onUndoDelete:()=>{C&&(k(e=>[...e,C]),S(C.id),B(null))}})})]})]})}},6246:(e,t,r)=>{Promise.resolve().then(r.bind(r,2969))}},e=>{e.O(0,[796,441,255,358],()=>e(e.s=6246)),_N_E=e.O()}]);